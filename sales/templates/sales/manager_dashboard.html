
{% extends "base.html" %}
{% block content %}
<div class="container">
    <!-- sales/templates/sales/manager_dashboard.html -->
{% include 'manager_nav.html' %}


<div class="container mt-5">


    <h3>Client Records</h3>
    <table class="table">
        <thead>
            <tr>
                <th>Business Name</th>
                <th>Owner Name</th>
                <th>Status</th>
                <th>Change Status</th>
            </tr>
        </thead>
        <tbody>
            {% for record in client_records %}
                <tr>
                    <td>{{ record.business_name }}</td>
                    <td>{{ record.owner_name }}</td>
                    <td>{{ record.get_approval_status_display }}</td>
                    <td>
                        <!-- Form for changing the approval status -->
                        <form method="POST" action="{% url 'change_approval_status' record.id %}">
                            {% csrf_token %}
                            <select name="approval_status" class="form-select">
                                <option value="pending" {% if record.approval_status == 'pending' %}selected{% endif %}>Pending</option>
                                <option value="approved" {% if record.approval_status == 'approved' %}selected{% endif %}>Approved</option>
                                <option value="rejected" {% if record.approval_status == 'rejected' %}selected{% endif %}>Rejected</option>
                            </select>
                            <button type="submit" class="btn btn-primary">Update Status</button>
                        </form>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="container">
    <h2>Client Records</h2>
    <input type="text" id="searchBox" placeholder="Search records..." class="form-control mb-3">
    
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Name</th>
                <th>Owner</th>
                <th>Phone Number</th>
                <th>Address</th>
            </tr>
        </thead>
        <tbody id="clientTable">
            {% for record in client_records %}
            <tr data-id="{{ record.id }}" class="client-row">
                <td>{{ record.business_name }}</td>
                <td>{{ record.owner_name }}</td>
                <td>{{ record.contact_info }}</td>
                <td>{{ record.location }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="4">No records found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    // Client-side search functionality
    $(document).ready(function () {
        $("#searchBox").on("keyup", function () {
            var value = $(this).val().toLowerCase();
            $("#clientTable tr").filter(function () {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
            });
        });

        // Row click functionality to load full profile
        $(".client-row").click(function () {
            var clientId = $(this).data("id");
            $.ajax({
                url: "/client-records/" + clientId + "/",
                method: "GET",
                success: function (data) {
                    // Display the full profile in a modal or dedicated section
                    alert(JSON.stringify(data));
                },
                error: function () {
                    alert("Failed to fetch client data.");
                }
            });
        });
    });
</script>
</div>
{% endblock %}
